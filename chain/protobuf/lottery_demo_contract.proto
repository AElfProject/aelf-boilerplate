syntax = "proto3";

import "aelf/core.proto";
import "aelf/options.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option csharp_namespace = "AElf.Contracts.LotteryDemoContract";

service LotteryDemoContract {
    option (aelf.csharp_state) = "AElf.Contracts.LotteryDemoContract.LotteryDemoContractState";
    
    rpc Initialize (InitializeInput) returns (google.protobuf.Empty) {
    }

    rpc NewPeriod (NewPeriodInput) returns (google.protobuf.Empty) {
    }
    rpc GetLuckyNumber (google.protobuf.Empty) returns (GetLuckyNumberOutput) {
    }
    rpc Bet (Lotteries) returns (google.protobuf.Empty) {
    }
    rpc RemoveExpiredBet(google.protobuf.Empty) returns (google.protobuf.Empty) {
    }
    rpc TakeReward (aelf.Hash) returns (google.protobuf.Empty) {
    }
    // Views
    rpc GetRecord (RecordInput) returns (RecordOutput) {
        option (aelf.is_view) = true;
    }
    // Views
    rpc GetState (google.protobuf.Empty) returns (GetStateOutput) {
        option (aelf.is_view) = true;
    }
}

message GetStateOutput {
    sint64  current_period = 1;
    google.protobuf.Timestamp current_time_stamp = 2;
    bool last_period_lucky_number_shown = 3;
    string token_symbol = 4;
    aelf.Address sponsor = 5;
    sint64 interval_time = 6;
}

message InitializeInput {
    aelf.Address sponsor = 1;
    sint64 start_period = 2;
    google.protobuf.Timestamp start_timestamp = 3;
    string token_symbol = 4;
    bool ready = 5;
}

message NewPeriodInput {
//    sint64 period_number = 1;
    aelf.Hash random_number_token = 1; // 随机的订单号
}

message GetLuckyNumberOutput {
    aelf.Hash random_hash = 1;
    sint64 period_number = 2;
    aelf.Hash random_number_token = 3;
    sint64 lucky_number = 4;
    google.protobuf.Timestamp lottery_time = 5;
}

message Lotteries {
    repeated Lottery lottery = 1;
    aelf.Address saler_address = 2; // 分销员地址
    sint32 proportion_sale = 3; // 销售分成 [0, 15] default 0
    sint32 proportion_bonus = 4; // 兑奖分成 [0, 5] default 0
    sint64 target_period = 5; // 当前期数，在APP里做
    aelf.Address sender_address = 6; // 用户地址 Context.Sender
}

message Lottery {
    sint32 type = 1;
    repeated sint32 value = 2;
}

message PeriodRandomNumberToken {
    aelf.Hash random_number_token = 1;
    google.protobuf.Timestamp timestamp = 2;
    google.protobuf.Timestamp lottery_time = 3;
    sint64 lucky_number = 4;
    sint64 period = 5;
}

message RecordInput {
    sint32 offset = 1;
    sint32 limit = 2;
}

message RecordOutput {
    sint32 offset = 1;
    sint32 limit = 2;
    sint64 current_period = 3;
    repeated PeriodRandomNumberToken records = 4;
}